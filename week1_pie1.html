<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="color-scheme" content="dark">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@500&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      background-color: #191919;
      margin: 0;
      font-family: 'DM Sans', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
    }
    h2 {
      color: #fff;
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 12px;
    }
    #chart {
      width: 700px;
      height: 400px;
    }
  </style>
</head>
<body>
  <h2>Week 1</h2>
  <div id="chart"></div>

  <script>
    google.charts.load("current", { packages: ["corechart"] });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      // city, North, South, East, West
      const rawData = [
        ["Riyadh", 6, 3, 2, 1],
        ["Jeddah", 5, 2, 3, 2],
        ["Dammam", 7, 1, 3, 2],
        ["Jubail", 2, 1, 1, 0],
        ["Arar",   1, 1, 1, 0]
      ];

      // Colors for North/South/East/West
      const colors = ["#78C889", "#6FA8FF", "#E6C45A", "#F07A7A"];

      // Build DataTable with HTML tooltips
      const data = new google.visualization.DataTable();
      data.addColumn("string", "City");
      data.addColumn("number", "North");
      data.addColumn({ type: "string", role: "tooltip", p: { html: true } });
      data.addColumn("number", "South");
      data.addColumn({ type: "string", role: "tooltip", p: { html: true } });
      data.addColumn("number", "East");
      data.addColumn({ type: "string", role: "tooltip", p: { html: true } });
      data.addColumn("number", "West");
      data.addColumn({ type: "string", role: "tooltip", p: { html: true } });
      data.addColumn({ type: "string", role: "annotation" }); // total annotation

      rawData.forEach(row => {
        const [city, n, s, e, w] = row;
        const total = n + s + e + w;

        const makeTooltip = (label, value, color) => `
          <div style="padding:8px 10px;background:#1f1f1f;border:1px solid #2c2c2c;border-radius:8px;color:#fff;">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
              <span style="display:inline-block;width:10px;height:10px;border-radius:3px;background:${color};"></span>
              <strong>${city} â€“ ${label}</strong>
            </div>
            <div>${value} of ${total}</div>
            <div style="opacity:.8;">${((value/total)*100).toFixed(1)}%</div>
          </div>
        `;

        data.addRow([
          city,
          n, makeTooltip("North", n, colors[0]),
          s, makeTooltip("South", s, colors[1]),
          e, makeTooltip("East",  e, colors[2]),
          w, makeTooltip("West",  w, colors[3]),
          String(total) // annotation
        ]);
      });

      const options = {
        backgroundColor: "#191919",
        isStacked: true,
        animation: { startup: true, duration: 900, easing: "out" },
        legend: {
          position: "top",
          textStyle: { color: "#DDDDDD", fontName: "DM Sans", fontSize: 13 }
        },
        tooltip: { isHtml: true },
        vAxis: {
          title: "Requests",
          textStyle: { color: "#CCCCCC", fontName: "DM Sans" },
          titleTextStyle: { color: "#FFFFFF", fontSize: 12, fontName: "DM Sans" },
          gridlines: { color: "#2a2a2a" },
          baselineColor: "#2a2a2a",
          viewWindow: { min: 0 }
        },
        hAxis: {
          textStyle: { color: "#DDDDDD", fontName: "DM Sans" }
        },
        chartArea: { left: "10%", top: "10%", width: "80%", height: "70%" },
        colors: colors,
        bar: { groupWidth: "60%" },
        annotations: {
          textStyle: { color: "#FFFFFF", fontName: "DM Sans", fontSize: 12 },
          alwaysOutside: true
        }
      };

      const chart = new google.visualization.ColumnChart(document.getElementById("chart"));
      chart.draw(data, options);

      // Redraw on resize
      window.addEventListener("resize", () => chart.draw(data, options));
    }
  </script>
</body>
</html>
